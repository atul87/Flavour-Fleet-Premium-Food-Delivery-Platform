<!DOCTYPE html>


<html lang="en" data-theme="dark">





<head>


    <meta charset="UTF-8">


    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>Checkout — Flavour Fleet</title>


    <link rel="stylesheet" href="css/style.css">


    <link rel="stylesheet" href="css/animations.css">


</head>





<body>





    <nav class="navbar" id="navbar">


        <div class="container">


            <a href="index.html" class="nav-logo"><i class="fas fa-fire logo-icon"></i><span>Flavour Fleet</span></a>


            <div class="nav-links" id="nav-links">


                <a href="restaurants.html">Restaurants</a>


                <a href="menu.html">Menu</a>


                <a href="offers.html" class="offers-link">Offers <span class="offers-badge">NEW</span></a>


                <a href="tracking.html">Track</a>


            </div>


            <div class="nav-actions">


                <button class="icon-btn theme-toggle" id="theme-toggle" aria-label="Toggle theme">


                    <svg viewBox="0 0 24 24">


                        <circle cx="12" cy="12" r="5" />


                        <line x1="12" y1="1" x2="12" y2="3" />


                        <line x1="12" y1="21" x2="12" y2="23" />


                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />


                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />


                        <line x1="1" y1="12" x2="3" y2="12" />


                        <line x1="21" y1="12" x2="23" y2="12" />


                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />


                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />


                    </svg>


                </button>


                <a href="cart.html" class="icon-btn nav-cart" aria-label="Cart">


                    <svg viewBox="0 0 24 24">


                        <circle cx="9" cy="21" r="1" />


                        <circle cx="20" cy="21" r="1" />


                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />


                    </svg>


                    <span class="cart-count" id="cart-count">0</span>


                </a>


                <div class="profile-dropdown-wrapper" id="profile-dropdown-wrapper">


                    <button class="icon-btn nav-profile" aria-label="Profile">


                        <svg viewBox="0 0 24 24">


                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />


                            <circle cx="12" cy="7" r="4" />


                        </svg>


                    </button>


                    <div class="profile-dropdown" id="profile-dropdown">


                        <a href="profile.html"><i class="fas fa-user"></i> Profile</a>


                        <a href="tracking.html"><i class="fas fa-box"></i> My Orders</a>


                        <a href="help.html"><i class="fas fa-cog"></i> Settings</a>


                        <div class="dropdown-divider"></div>


                        <a href="login.html" class="dropdown-logout"><i class="fas fa-sign-out-alt"></i> Logout</a>


                    </div>


                </div>


                <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>


            </div>


        </div>


    </nav>





    <section class="page-header">


        <div class="container">


            <h1>💳 Checkout</h1>


            <p>Complete your order</p>


        </div>


    </section>





    <section class="section">


        <div class="container">


            <div class="checkout-layout">


                <div>


                    <div class="glass-card" style="padding:var(--space-xl);margin-bottom:var(--space-xl)">


                        <h3 style="margin-bottom:var(--space-lg)">“ Delivery Details</h3>


                        <div class="form-row">


                            <div class="form-group"><label>Full Name</label><input type="text" id="checkout-name"


                                    placeholder="e.g. Rahul Sharma"></div>


                            <div class="form-group"><label>Phone Number</label><input type="tel" id="checkout-phone"


                                    placeholder="+91 98765 43210"></div>


                        </div>


                        <div class="form-group"><label>Delivery Address</label><input type="text" id="checkout-address"


                                placeholder="Flat/House No, Building, Street"></div>


                        <div class="form-row">


                            <div class="form-group"><label>City</label><input type="text" id="checkout-city"


                                    placeholder="Mumbai"></div>


                            <div class="form-group"><label>ZIP or PIN Code</label><input type="text" id="checkout-zip"


                                    placeholder="400001"></div>


                        </div>


                        <div class="form-group"><label>Delivery Instructions</label><textarea id="checkout-instructions"


                                rows="3" placeholder="e.g. Leave with security, or ring doorbell..."


                                style="width:100%;padding:0.75rem 1rem;border-radius:var(--radius-md);background:var(--bg-tertiary);border:1px solid var(--border-color);color:var(--text-primary);resize:vertical"></textarea>


                        </div>


                    </div>





                    <div class="glass-card" style="padding:var(--space-xl)">


                        <h3 style="margin-bottom:var(--space-lg)">Payment Method</h3>


                        <div class="payment-methods">


                            <div class="payment-method active" onclick="selectPayment(this)"><span


                                    class="payment-icon"><i class="fas fa-mobile-alt"></i></span><span>UPI (GPay/PhonePe)</span></div>


                            <div class="payment-method" onclick="selectPayment(this)"><span


                                    class="payment-icon"><i class="fas fa-university"></i></span><span>Net Banking</span></div>


                            <div class="payment-method" onclick="selectPayment(this)"><span


                                    class="payment-icon"><i class="fas fa-money-bill-wave"></i></span><span>Cash on Delivery</span></div>


                        </div>


                        <div id="upi-note"


                            style="margin-top:var(--space-md);padding:var(--space-sm);background:rgba(255,107,53,0.1);border-radius:var(--radius-md);font-size:0.85rem;color:var(--primary);display:flex;align-items:center;gap:8px">


                            <span><i class="fas fa-lightbulb"></i></span> Pay directly via your favorite UPI app


                        </div>


                    </div>


                </div>





                <div>


                    <div class="cart-summary">


                        <h3>Order Summary</h3>


                        <div id="checkout-items"></div>


                        <div id="checkout-summary"></div>


                        <button class="btn btn-primary btn-lg" style="width:100%;margin-top:var(--space-lg)"


                            onclick="placeOrder()">Place Order</button>


                    </div>


                </div>


            </div>


        </div>


    </section>





    <footer class="footer">


        <div class="container">


            <div class="footer-bottom">


                <p>Â© 2026 Flavour Fleet. All rights reserved.</p>


            </div>


        </div>


    </footer>


    <div class="toast-container" id="toast-container"></div>


    <div class="page-loader" id="page-loader">


        <div class="loader-spinner"></div>


        <p>Loading checkout...</p>


    </div>





    <script src="js/api.js"></script>


    <script src="js/cart.js"></script>


    <script src="js/auth.js"></script>


    <script src="js/main.js"></script>


    <script>


        function selectPayment(el) {


            document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('active'));


            el.classList.add('active');


        }


        async function renderCheckout() {


            await Cart.syncFromServer();


            const items = Cart.getCart();


            const itemsEl = document.getElementById('checkout-items');


            const summaryEl = document.getElementById('checkout-summary');


            if (!items.length) {


                itemsEl.innerHTML = '<p style="color:var(--text-muted)">Your cart is empty. <a href="menu.html" style="color:var(--primary)">Browse Menu</a></p>';


                return;


            }


            itemsEl.innerHTML = items.map(i => `<div style="display:flex;justify-content:space-between;margin-bottom:var(--space-sm);font-size:0.9rem"><span>${i.name} × ${i.quantity}</span><span>₹${Math.round(i.price * i.quantity)}</span></div>`).join('');


            const sub = Cart.getSubtotal();


            const tax = Cart.getTax();


            const del = Cart.getDeliveryFee();


            const total = Cart.getTotal();


            summaryEl.innerHTML = `<div class="summary-row"><span>Subtotal</span><span>₹${Math.round(sub)}</span></div><div class="summary-row"><span>Delivery Fee</span><span>₹${Math.round(del)}</span></div><div class="summary-row"><span>GST (5%)</span><span>₹${Math.round(tax)}</span></div><div class="summary-row total"><span>Total</span><span>₹${Math.round(total)}</span></div>`;


        }


        async function placeOrder() {


            await Cart.syncFromServer();


            const items = Cart.getCart();


            if (!items.length) { showToast('Cart is empty!', 'error'); return; }





            // --- Indian Phone & PIN Validation ---


            const fields = [


                { id: 'checkout-name', label: 'Full Name', required: true },


                { id: 'checkout-phone', label: 'Phone Number', required: true, pattern: /^[6-9]\d{9}$/, patternMsg: 'Please enter a valid 10-digit Indian phone number' },


                { id: 'checkout-address', label: 'Delivery Address', required: true },


                { id: 'checkout-city', label: 'City', required: true },


                { id: 'checkout-zip', label: 'PIN Code', required: true, pattern: /^\d{6}$/, patternMsg: 'Enter a valid 6-digit Indian PIN code' }


            ];





            // Clear previous errors


            document.querySelectorAll('.checkout-error').forEach(el => el.remove());


            document.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));





            let hasError = false;


            for (const field of fields) {


                const input = document.getElementById(field.id);


                if (!input) continue;


                let val = input.value.trim();





                // Clean up phone number for validation


                if (field.id === 'checkout-phone') {


                    val = val.replace(/\s+|-/g, ''); // Remove spaces/dashes


                    if (val.startsWith('+91')) val = val.substring(3);


                    if (val.startsWith('0')) val = val.substring(1);


                }





                let errorMsg = '';


                if (field.required && !val) {


                    errorMsg = `${field.label} is required`;


                } else if (field.pattern && val && !field.pattern.test(val)) {


                    errorMsg = field.patternMsg;


                }





                if (errorMsg) {


                    hasError = true;


                    input.style.borderColor = '#ef4444';


                    input.classList.add('field-error');


                    const errEl = document.createElement('span');


                    errEl.className = 'checkout-error';


                    errEl.style.cssText = 'color:#ef4444;font-size:0.75rem;display:block;margin-top:2px';


                    errEl.textContent = errorMsg;


                    input.parentNode.appendChild(errEl);


                } else {


                    input.style.borderColor = '';


                }


            }





            if (hasError) {


                showToast('Please fix the errors above', 'error');


                return;


            }





            // Disable button to prevent double-click


            const btn = document.querySelector('.btn-primary.btn-lg');


            if (btn) { btn.disabled = true; btn.textContent = 'â Placing Order...'; }





            const orderData = {


                name: document.getElementById('checkout-name')?.value || '',


                phone: document.getElementById('checkout-phone')?.value || '',


                address: document.getElementById('checkout-address')?.value || '',


                city: document.getElementById('checkout-city')?.value || '',


                zip: document.getElementById('checkout-zip')?.value || '',


                instructions: document.getElementById('checkout-instructions')?.value || '',


                payment_method: document.querySelector('.payment-method.active')?.textContent?.trim() || 'UPI',


                discount: 0


            };





            const result = await API.post('/orders', orderData);


            if (result.success) {


                // Store current order for tracking page


                localStorage.setItem('flavourfleet_current_order', JSON.stringify(result.order));


                showToast(result.message || 'Order placed successfully! 🎉', 'success');


                setTimeout(() => { window.location.href = 'order-confirmation.html'; }, 1500);


            } else {


                showToast(result.message || 'Failed to place order', 'error');


                if (btn) { btn.disabled = false; btn.textContent = '🎉 Place Order'; }


            }


        }


        document.addEventListener('DOMContentLoaded', renderCheckout);


    </script>


</body>





</html>